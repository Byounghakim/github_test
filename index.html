// 사용할 Google API 클라이언트 ID 및 키
var CLIENT_ID = 'YOUR_CLIENT_ID';
var API_KEY = 'YOUR_API_KEY';

// 인증 및 API 로드
gapi.load('client:auth2', initClient);

function initClient() {
    gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
        scope: 'https://www.googleapis.com/auth/drive.file'
    }).then(function() {
        // 인증 완료 후 파일 업로드 로직 실행
        uploadFileToDrive(csvContent);
    });
}

function uploadFileToDrive(csvContent) {
    var fileMetadata = {
        'name': 'submission.csv', // 파일 이름
        'mimeType': 'text/csv' // MIME 타입
    };

    var mediaContent = new Blob([csvContent], {type: 'text/csv'});
    var accessToken = gapi.auth.getToken().access_token;
    var form = new FormData();
    form.append('metadata', new Blob([JSON.stringify(fileMetadata)], {type: 'application/json'}));
    form.append('file', mediaContent);

    // 구글 드라이브에 파일 업로드 요청
    fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {
        method: 'POST',
        headers: new Headers({'Authorization': 'Bearer ' + accessToken}),
        body: form
    }).then(response => response.json())
    .then(data => {
        console.log('File ID:', data.id);
        alert('파일이 성공적으로 업로드되었습니다!');
    })
    .catch(error => console.error('Error uploading file:', error));
}